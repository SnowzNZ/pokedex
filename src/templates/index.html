<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pokedex</title>
    <link rel="stylesheet" href="../static/style.css" />
  </head>
  <body>
    <a href="/"><h1>pokedex üêõ</h1></a>
    <form action="/upload" method="post" enctype="multipart/form-data">
      <input type="file" id="csvFile" name="csvFile" accept=".csv" />
      <input type="submit" value="Import from CSV" name="submit" />
    </form>

    <input type="text" id="searchBar" placeholder="Search for Pok√©mon..." />

    <div class="table">
      <table id="pokemonTable">
        <thead>
          <tr>
            {% for column in cur.description %} {% if column[0] != 'id' %}
            <th>{{ column[0] }}</th>
            {% endif %} {% endfor %}
          </tr>
        </thead>
        <tbody id="pokemonTableBody">
          {% for pkm in pokemon %}
          <tr id="{{ pkm[0] }}">
            {% for value in pkm[1:] %}
            <td contenteditable="false">{{ value }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="pagination">
        <a href="{{ url_for('index', page=page-1) if page > 1 else '#' }}"
          >Previous</a
        >
        <span>Page {{ page }}</span>
        <a href="{{ url_for('index', page=page+1) }}">Next</a>
      </div>
    </div>

    {% if not pokemon %}
    <p>No Pokemon data found! Maybe import some data from a CSV?</p>
    {% endif %}

    <script>
      const searchBar = document.getElementById('searchBar');
      const pokemonTableBody = document.getElementById('pokemonTableBody');
      const columns = [{% for column in cur.description %}{% if column[0] != 'id' %}"{{ column[0] }}",{% endif %}{% endfor %}];

      searchBar.addEventListener('input', async () => {
        const query = searchBar.value;
        const response = await fetch(`/search?query=${query}`);
        const results = await response.json();

        pokemonTableBody.innerHTML = '';
        results.forEach(pokemon => {
          const row = document.createElement('tr');
          columns.forEach(column => {
            const cell = document.createElement('td');
            cell.textContent = pokemon[column];
            row.appendChild(cell);
          });
          pokemonTableBody.appendChild(row);
        });
      });
    </script>
  </body>
</html>
